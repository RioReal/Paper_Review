# Rui Wang, 2020/11/10

# Paper information
- Title: JumpSwitches: Restoring the Performance of Indirect Branches In the Era of Spectre
- Authors: Nadav Amit, Fred Jacobs, Michael Wei
- Venue: USENIX ATC 2019
- Keywords: Spectre, indirect branches

# Paper content

## Summary
* To defend the **Spectre variant2**, which takes advantage of speculative execution caused by indirect branches to leak secret, they design JumpSwitches to transfer unsafe code fragment to safe trampolines.

* Indirect branches are a type of instructions that enable programs to dynamically change when code is executed by the program at runtime. With an indirect branch, the processor cannot fetch the next instruction until the branch target is computed, resulting in pipeline stalls that degrade performance. To eliminate the stalls, processors leverage **speculation** to guess the branch target and rolls back when the guess is determined to be incorrect. The Spectre variant2 observed that rolling back speculation can be incomplete so that it might leave memory as a result of some privileged code in the caches. Then, by the side-channel attack, we can get some key important data.

* The traditional defending way is **retpolines** to disallow unsafe speculation. When the CPU wants to do speculative executions in indirect branches, retpolines directs the control flow into an infinite loop and returning to the actual address when the CPU knows the branch target. However, retpolines will result in slowdowns because of the stalls caused by the loop.

*  The idea is also inspired by the **indirect call promotions**. Contrary to indirect calls, direct calls use immediate numbers rather than registers. Indirect call promotions replace indirect calls with directs ones by comparing the most likely branch targets with the dynamic target first and returning to indirect ones if the prediction is wrong. The direct branches cost less because the branch targets are static, but indirect call promotions increase code size because of the replacement, and branch targets of the direct call are not flexible at runtime because they are generated by the compiler.

* JumpSwitches ensure the security of speculative branch executions, but also optimize the performance comparing with indirect call promotions. The key idea is similar to indirect call promotions. They invented several types of JumpSwitches like inline, outline, registration, instance ones. Different kinds of JumpSwitches are optimized for different cases so that they can go to learned branch targets without increasing much more code size.

* /* more info about all kinds of js */

* The paper evaluates the JumpSwitches by testing both microbenchmarks and macrobenchmarks. They evaluate system calls in a microbenchmark as syscalls have shown to
a particular source of the slowdown as a result of both the Meltdown and Spectre hardware vulnerabilities. The marcobenchmarks test on a mixture of file read, write and
flush operations, running on a temporary file-system. JumpSwitches can narrow the difference between protected by retpolines and non-protected systems to less than 3%.

## Strengths
1. It seems easy to implement so-called JumpSwitches.

1. Many variants are come up with so that they can work in many cases.

## Weaknesses
1. The idea is not so novel.
1. The evaluation doesn't compare JumpSwitches with indirect call promotions.
